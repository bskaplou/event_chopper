<html>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="http://yui.yahooapis.com/3.4.1/build/yui/yui-min.js"></script>
<link rel="stylesheet" href="http://yui.yahooapis.com/3.4.1/build/cssgrids/grids-min.css">
<script src="http://datejs.googlecode.com/files/date.js" type="text/javascript"></script>
<form method='get' onsubmit='onsub(); return false;'>
Start date: <input type='text' name='start' id='start' value=''><br>
Stop date: <input type='text' name='stop' id='stop' value=''><br>
Group by: <select name='group' id='group'>
<option value='ten_minutes'>10 Minutes</option>
<option value='hour' selected="selected">Hour</option>
<option value='day'>Day</option>
<option value='month'>Month</option>
<option value='year'>Year</option>
</select><br>
<input type='submit'/>
</form>
<div id="container"  class="yui3-skin-sam" style="width: 100%; height: 100%"></div>
<script>
$(document).ready(function() {
  var cur = Date.today().add(1).days();
  var last = Date.today().add(-1).days();
  $('#start').val(last.toString('yyyy-MM-dd hh:00'));
  $('#stop').val(cur.toString('yyyy-MM-dd hh:00'));
});

function onsub() {
  draw_graph($('#start').val(), $('#stop').val(), $('#group').val());
}

function draw_graph(from, to, period) {
$.getJSON('/json?from=' + from + '&to=' + to + '&period=' + period + '&reporter=Scb', function(data) {
YUI().use('datatable', function (Y) {
var cols = ['time','search', 'click', 'booking', 'paid_booking'];

var dts = [];

for(var k in data) {
   if(data[k] == null) {
     dts.push({time: k,search: 0, click: 0, booking: 0, paid_booking: 0});
   } else {
     dts.push({time: k,search: data[k]['search'], click: data[k]['click'], booking: data[k]['booking'], paid_booking: data[k]['paid_booking']});
   }
}

$('#container').html("");
var table = new Y.DataTable.Base({
    columnset: cols,
    recordset: dts
}).render("#container");

});
});
}</script>
</html>
